{% extends 'app_rapports/base.html' %}

{% block content %}

<!-- HEADER -->
<div class="d-flex justify-content-between align-items-center mb-4">

    <!-- TITRE AVEC ICÔNE -->
    <h2 class="fw-bold text-dark mb-0 d-flex align-items-center gap-2">
        <i class="bi bi-collection  text-primary"></i>
        Requêtes SQL
    </h2>

    <!-- BOUTON AJOUTER AVEC ICÔNE  -->
    <a href="{% url 'query_create' %}"
       class="btn btn-primary px-4 py-2 rounded-pill shadow-sm d-flex align-items-center gap-2">
        <i class="bi bi-plus-circle-fill"></i>
        Nouvelle Requête
    </a>
</div>


<!-- TABLE CARD -->
<div class="card border-0 shadow-sm rounded-4">

    <!-- Scroll Horizontal -->
    <div class="table-responsive">

        <table class="table table-hover table-sm table-nowrap align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th class="py-3 px-4">Nom</th>
                    <th class="py-3">Base</th>
                    <th class="py-3">Destinataires</th>
                    <th class="py-3 text-center">Télécharger</th>
                    <th class="py-3 text-center">Envoyer</th>
                </tr>
            </thead>

            <tbody>
                {% for q in queries %}
                <tr>
                    <!-- Nom -->
                    <td class="font-weight px-4">{{ q.name }}</td>

                    <!-- Base -->
                    <td class="text-muted">{{ q.database.name }}</td>

                    <!-- Destinataires -->
                    <td class="text-muted">
                       {{ q.email_list|default:"—" }}
                          </td>


                    <!-- Télécharger -->
                    <td class="text-center">
                        <a href="{% url 'query_download' q.id %}"
                           class="btn btn-outline-primary btn-sm rounded-pill px-3 shadow-sm d-flex justify-content-center align-items-center gap-2 mx-auto">
                            <i class="bi bi-download"></i> Télécharger
                        </a>
                    </td>
                    

                    <!-- Envoyer -->
                    <td class="text-center">
                        <a href="{% url 'query_run' q.id %}"
                           class="btn btn-outline-success btn-sm rounded-pill px-3 shadow-sm d-flex justify-content-center align-items-center gap-2 mx-auto">
                            <i class="bi bi-send-fill"></i> Envoyer
                        </a>
                    </td>
                </tr>

                {% empty %}
                <tr>
                    <td colspan="5" class="text-center text-muted py-5 fs-6">
                        Aucune requête enregistrée.
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>
</div>


<!-- CUSTOM STYLE PRO -->
<style>

.table-responsive {
    border-radius: 0 0 1rem 1rem;
}

.table-nowrap td, .table-nowrap th {
    white-space: nowrap;
}

.table td {
    max-width: 250px;
    overflow: hidden;
    text-overflow: ellipsis;
}

.table-hover tbody tr:hover {
    background-color: #f5f7fa !important;
    transition: 0.2s ease;
}

.card {
    border-radius: 1rem !important;
}

.btn {
    font-weight: 500;
}

.btn i {
    font-size: 1rem;
}

/* Icône du titre un peu plus grande */
h2 i {
    font-size: 1.4rem;
}

</style>

{% endblock %}
